import{r as t,a9 as a,j as e,aa as b,e as j,ac as C,B as f,ad as I,ae as F,af as _}from"./index-f064b6f1.js";import{M as w}from"./index-cbfecec5.js";import{a as L,T as K}from"./Table-1818aa71.js";import"./index-3181c73c.js";const E=c=>{const[y,r]=t.useState(!1),[x,d]=t.useState("create"),[n]=a.useForm();t.useImperativeHandle(c.mRef,()=>({open:l}));const l=(o,u)=>{r(!0),d(o),u&&n.setFieldsValue(u)},i=async()=>{await n.validateFields()&&(x==="create"?(await j.createRole(n.getFieldsValue()),C.success("创建成功")):(await j.editRole(n.getFieldsValue()),C.success("编辑成功")),p(),c.update())},p=()=>{n.resetFields(),r(!1)};return e.jsx(w,{open:y,title:x==="create"?"创建角色":"编辑角色",width:800,onOk:i,onCancel:p,children:e.jsxs(a,{form:n,layout:"horizontal",labelCol:{span:4},labelAlign:"right",children:[e.jsx(a.Item,{name:"_id",hidden:!0,children:e.jsx(b,{})}),e.jsx(a.Item,{label:"角色名称",name:"roleName",rules:[{required:!0,message:"请输入角色名称"}],children:e.jsx(b,{placeholder:"请输入角色名称"})}),e.jsx(a.Item,{label:"备注",name:"remark",children:e.jsx(b.TextArea,{placeholder:"请输入备注"})})]})})},M=c=>{const[y,r]=t.useState(!1),[x,d]=t.useState([]),[n,l]=t.useState([]),[i,p]=t.useState(),[o,u]=t.useState();t.useEffect(()=>{R()},[]);const R=async()=>{const k=await j.getMenuList();d(k)};t.useImperativeHandle(c.mRef,()=>({open:s}));const s=(k,h)=>{r(!0),p(h),l((h==null?void 0:h.permissionList.checkedKeys)||[])},m=(k,h)=>{l(k);const v=[],S=[];h.checkedNodes.forEach(g=>{g.menuType===2?v.push(g._id):S.push(g._id)}),u({_id:(i==null?void 0:i._id)||"",permissionList:{checkedKeys:v,halfCheckedKeys:S.concat(h.halfCheckedKeys)}})},H=async()=>{o&&(console.log(o),await j.updatePermission(o),C.success("设置成功"),N(),c.update())},N=()=>{r(!1),u(void 0)};return e.jsx(w,{open:y,title:"设置权限",width:800,onOk:H,onCancel:N,children:e.jsxs(a,{layout:"horizontal",labelCol:{span:4},labelAlign:"right",children:[e.jsx(a.Item,{label:"角色名称",children:i==null?void 0:i.roleName}),e.jsx(a.Item,{label:"权限",children:e.jsx(L,{checkable:!0,defaultExpandAll:!0,fieldNames:{title:"menuName",key:"_id",children:"children"},onCheck:m,checkedKeys:n,treeData:x})})]})})},P=()=>{const[c]=a.useForm(),[y,r]=t.useState([]),x=[{title:"角色名称",dataIndex:"roleName"},{title:"备注",dataIndex:"remark"},{title:"创建时间",dataIndex:"createTime",render:s=>I(s)},{title:"更新时间",dataIndex:"updateTime",render:s=>I(s)},{title:"操作",render(s){return e.jsxs(F,{children:[e.jsx(f,{type:"text",onClick:()=>o(s),children:"编辑"}),e.jsx(f,{type:"text",onClick:()=>u(s),children:"设置权限"}),e.jsx(f,{type:"text",danger:!0,onClick:()=>R(s),children:"删除"})]})}}],d=t.useRef(),n=t.useRef();t.useEffect(()=>{l()},[]);const l=async()=>{const s=await j.getRoleList(c.getFieldsValue());r(s.list)},i=()=>{c.resetFields()},p=()=>{var s;(s=d.current)==null||s.open("create")},o=s=>{var m;(m=d.current)==null||m.open("edit",s)},u=s=>{var m;(m=n.current)==null||m.open("edit",s)},R=s=>{_.confirm({title:"确认删除",content:"确认删除该角色吗？",onOk:async()=>{await j.delteRole({_id:s._id}),C.success("删除成功"),l()}})};return e.jsxs("div",{className:"user-list",children:[e.jsxs(a,{form:c,layout:"inline",className:"search-form",children:[e.jsx(a.Item,{label:"角色名称",name:"roleName",children:e.jsx(b,{placeholder:"角色名称"})}),e.jsxs(a.Item,{children:[e.jsx(f,{type:"primary",className:"mr10",onClick:l,children:"搜索"}),e.jsx(f,{type:"default",onClick:i,children:"重置"})]})]}),e.jsxs("div",{className:"base-table",children:[e.jsxs("div",{className:"header-wrap",children:[e.jsx("div",{className:"title",children:"角色列表"}),e.jsx("div",{className:"action",children:e.jsx(f,{type:"primary",onClick:()=>p(),children:"新增"})})]}),e.jsx(K,{bordered:!0,rowKey:"_id",columns:x,dataSource:y,pagination:!1})]}),e.jsx(E,{mRef:d,update:l}),e.jsx(M,{mRef:n,update:l})]})};export{P as default};

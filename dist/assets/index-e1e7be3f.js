import{a9 as s,r as l,e as m,j as e,aa as g,ac as w,B as o,ad as N,ae as v,af as C}from"./index-048001ff.js";import{M as L}from"./index-de2b5524.js";import{T as k}from"./index-c7d9fd56.js";import{S}from"./index-3bbe5032.js";import{T as F}from"./Table-a9fffeff.js";const H=r=>{const[c]=s.useForm(),[p,j]=l.useState("create"),[d,n]=l.useState(!1),[f,x]=l.useState([]),[u,y]=l.useState([]);l.useEffect(()=>{t()},[]),l.useImperativeHandle(r.mRef,()=>({open:i}));const b=async()=>{const a=await m.getDeptList();x(a)},t=async()=>{const a=await m.getAllUserList();y(a)},i=(a,I)=>{b(),j(a),I&&c.setFieldsValue(I),n(!0)},h=async()=>{const a=await c.validateFields();a&&(p==="create"?(await m.createDept(a),w.success("添加成功")):(await m.editDept(a),w.success("编辑成功"))),D(),r.update()},D=()=>{c.resetFields(),n(!1)};return e.jsx(L,{title:p==="create"?"创建用户":"编辑用户",width:800,open:d,onOk:h,onCancel:D,children:e.jsxs(s,{form:c,layout:"horizontal",labelCol:{span:4},labelAlign:"right",children:[e.jsx(s.Item,{hidden:!0,name:"_id",children:e.jsx(g,{})}),e.jsx(s.Item,{label:"上级部门",name:"parentId",children:e.jsx(k,{showSearch:!0,style:{width:"100%"},dropdownStyle:{maxHeight:400,overflow:"auto"},placeholder:"请选择上级部门",allowClear:!0,treeDefaultExpandAll:!0,treeData:f,fieldNames:{label:"deptName",value:"_id"}})}),e.jsx(s.Item,{label:"部门名称",name:"deptName",rules:[{required:!0,message:"请选择部门名称"}],children:e.jsx(g,{placeholder:"请选择部门名称"})}),e.jsx(s.Item,{label:"负责人",name:"userName",rules:[{required:!0,message:"请选择负责人"}],children:e.jsx(S,{placeholder:"请选择负责人",children:u==null?void 0:u.map(a=>e.jsx(S.Option,{value:a._id,children:a.userName},a._id))})})]})})},M=()=>{const[r]=s.useForm(),c=[{title:"部门名称",dataIndex:"deptName"},{title:"负责人",dataIndex:"userName"},{title:"创建时间",dataIndex:"createTime",render:t=>N(t)},{title:"更新时间",dataIndex:"updateTime",render:t=>N(t)},{title:"操作",render(t){return e.jsxs(v,{children:[e.jsx(o,{type:"text",onClick:()=>x(t),children:"新增"}),e.jsx(o,{type:"text",onClick:()=>u(t),children:"编辑"}),e.jsx(o,{type:"text",danger:!0,onClick:()=>y(t),children:"删除"})]})}}],[p,j]=l.useState([]),d=l.useRef();l.useEffect(()=>{n()},[]);const n=async()=>{const t=await m.getDeptList(r.getFieldsValue());j(t)},f=()=>{r.resetFields()},x=t=>{var i,h;t!=null&&t.parentId?(i=d.current)==null||i.open("create",{parentId:t==null?void 0:t._id}):(h=d.current)==null||h.open("create")},u=t=>{var i;(i=d.current)==null||i.open("edit",t)},y=t=>{C.confirm({title:"确认删除",content:"确认删除该部门吗?",onOk:()=>{b(t._id)}})},b=async t=>{await m.deleteDept({_id:t}),w.success("删除成功"),n()};return e.jsxs("div",{className:"user-list",children:[e.jsxs(s,{form:r,layout:"inline",className:"search-form",children:[e.jsx(s.Item,{label:"部门名称",name:"deptName",children:e.jsx(g,{placeholder:"部门名称"})}),e.jsxs(s.Item,{children:[e.jsx(o,{type:"primary",className:"mr10",onClick:n,children:"搜索"}),e.jsx(o,{type:"default",onClick:f,children:"重置"})]})]}),e.jsxs("div",{className:"base-table",children:[e.jsxs("div",{className:"header-wrap",children:[e.jsx("div",{className:"title",children:"部门列表"}),e.jsx("div",{className:"action",children:e.jsx(o,{type:"primary",onClick:()=>x(),children:"新增"})})]}),e.jsx(F,{bordered:!0,rowKey:"_id",columns:c,dataSource:p,pagination:!1})]}),e.jsx(H,{mRef:d,update:n})]})};export{M as default};
